<% if flash[:notice] %>
  <div class="alert alert-info" role="alert">
    <%= flash[:notice] %>
  </div>
<% end %>

<% if flash[:error] %>
  <div class="alert alert-danger" role="alert">
    <%=flash[:error]%>
  </div>
<% end %>
  
  <div class='row align-items-center'>
    <h1 style='margin-right: 2rem;'>Listado de usuarios</h1>
    <% if policy(:usuarios).create? %>
      <%= link_to 'Crear usuario', registro_path, class: 'btn btn-primary' %>
    <% end %>
  </div>
	<table id="tablaUsuarios" class="table table-bordered mt-5">
      <thead>
        <tr>
          <th class="col-1">ID</th>
          <th class="col-4">Nombre y Apellido</th>
          <th class="col-2">Rol</th>
          <th class="col-5">Email</th>
          <%if policy(:usuarios).cambiar_rol?%>
          <th class="col-5">Acciones</th>
          <%end%>
        </tr>
      </thead>
      
      <tbody id="elementosUsuarios">
      </tbody>
    </table>


<script type="module">
  const tabla = document.getElementById("tablaUsuarios");
  const elementos = document.getElementById("elementosUsuarios");

  function agregarUsuario(datos){
      if(datos["action"] == "get_start"){
        if (datos["count"] === 0){
          tabla.innerHTML = "<h3>No hay usuarios en la plataforma.</h3>";
        }
        return;
      }

      elementos.innerHTML+= datos["view_usuario"];
  }

  function desuscribirseUsuarios(){
    unsuscribe("Usuarios");
    window.removeEventListener("turbo:visit", desuscribirseUsuarios);
  }
  window.addEventListener("turbo:visit", desuscribirseUsuarios);
  suscribe("Usuarios", agregarUsuario, true);

</script>